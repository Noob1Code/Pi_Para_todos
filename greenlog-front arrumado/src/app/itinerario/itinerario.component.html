<app-modal-rota 
  [visivel]="modalRotasVisivel" 
  (fechado)="fecharModalRotas()" 
  (rotaSelecionado)="onRotaSelecionado($event)">
</app-modal-rota>

<app-modal-caminhao
  [visivel]="modalCaminhaoVisivel"
  (fechado)="fecharModalCaminhao()"
  (caminhaoSelecionado)="onCaminhaoSelecionado($event)">
</app-modal-caminhao>

<main class="form-container">

  <header>
    <h2>GreenLog - Planejamento de ItinerÃ¡rios</h2>
  </header>

  <nav class="form-group mes-navegacao" aria-label="NavegaÃ§Ã£o entre meses">
    <button class="btn" (click)="alterarMes(-1)" aria-label="MÃªs anterior">â¬…ï¸</button>
    <span class="mes-atual" aria-live="polite">{{ mesSelecionado + 1 }}/{{ anoSelecionado }}</span>
    <button class="btn" (click)="alterarMes(1)" aria-label="PrÃ³ximo mÃªs">â¡ï¸</button>
  </nav>

  <div class="form-group filtro-caminhao">
    <label for="caminhaoFiltro">CaminhÃ£o Selecionado:</label>
    <input
      type="text"
      id="caminhaoFiltro"
      placeholder="Clique para selecionar um caminhÃ£o"
      readonly
      [value]="caminhaoFiltrado?.placa || ''"
      (click)="abrirModalCaminhao()"
      aria-describedby="caminhaoDescricao"
    />
    <small id="caminhaoDescricao">Clique no campo para filtrar os agendamentos por caminhÃ£o.</small>
  </div>

  <div *ngIf="caminhaoFiltrado">
    <button class="btn cancelar" (click)="limparFiltroCaminhao()">Limpar filtro</button>
  </div>
  
  <div *ngIf="mensagem?.tipo" [ngClass]="['popup', mensagem.tipo === 'erro' ? 'error' : 'success']">
    <span *ngIf="mensagem.tipo === 'salvo'">âœ…</span>
    <span *ngIf="mensagem.tipo === 'editado'">âœï¸</span>
    <span *ngIf="mensagem.tipo === 'excluido'">ğŸ—‘ï¸</span>
    <span *ngIf="mensagem.tipo === 'erro'">âŒ</span>
    {{ mensagem.texto }}
  </div>

  <section class="calendar" aria-label="CalendÃ¡rio de agendamentos">
    <div class="header" *ngFor="let dia of diasDaSemana">{{ dia }}</div>
    <div class="day vazio" *ngFor="let v of diasVazios" aria-hidden="true"></div>

    <button
  type="button"
  class="day"
  *ngFor="let dia of diasDoMes"
  [ngClass]="{
    hoje: isHoje(dia),
    selecionado: isSelecionado(dia),
  }"
  (click)="abrirFormulario(dia)"
>
  <strong>{{ dia.getDate() }}</strong>

  <span
    *ngIf="temAgendamento(dia)"
    class="pin-icon"
    title="Ver agendamentos do dia"
    (click)="verAgendamentos(dia); $event.stopPropagation()"
    style="cursor: pointer;"
  >ğŸ“Œ</span>
</button>
  </section>

  <section *ngIf="diaConsultado" class="consulta" aria-live="polite">
    <h3>Agendamentos para {{ diaConsultado | date: 'fullDate' }}:</h3>

    <ng-container *ngIf="obterAgendamentosDoDia(diaConsultado).length > 0; else semAgendamento">
      <ul>
        <li *ngFor="let agendamento of obterAgendamentosDoDia(diaConsultado)">
          CaminhÃ£o: {{ agendamento.rota.caminhao?.placa }} â€“ Destino: {{ agendamento.rota.destino?.nome }}
          <button class="btn editar" title="Editar" (click)="editar(agendamento)">âœï¸</button>
          <button class="btn excluir" title="Excluir" (click)="excluir(agendamento)">ğŸ—‘ï¸</button>
        </li>
      </ul>
    </ng-container>

    <ng-template #semAgendamento>
      <p>Nenhum itinerÃ¡rio planejado para este dia.</p>
    </ng-template>
  </section>

  <section *ngIf="diaSelecionado" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="agendamentoTitulo">
    <div class="modal-form">
      <h3 id="agendamentoTitulo">Agendar Rota para {{ diaSelecionado | date: 'fullDate' }}</h3>

      <div class="form-group">
        <label for="rota">Rota Selecionada:</label>
        <input
          type="text"
          id="rota"
          name="rota"
          placeholder="Clique para selecionar uma rota"
          readonly
          [value]="rotaSelecionada?.destino?.nome || ''"
          (click)="abrirModalRotas()"
          aria-describedby="rotaDescricao"
        />
        <small id="rotaDescricao">Clique no campo para abrir a seleÃ§Ã£o de rotas disponÃ­veis.</small>
      </div>

      <div class="button-group">
        <button class="btn salvar" (click)="salvar()" [disabled]="!rotaSelecionada">ğŸ’¾ Agendar</button>
        <button class="btn cancelar" (click)="fecharAgendamento()">âŒ Cancelar</button>
      </div>
    </div>
  </section>

</main>
   